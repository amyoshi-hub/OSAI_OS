まずlinuxのkernelをダウンロード
make defconfig
make
でbzImageを作る

initrafs　ディレクトリを作る
initを以下のコードにする

#include <unistd.h>
#include <stdio.h>

int main() {
    write(1, "HELLO from init\n", 16);
    execl("/bin/sh", "sh", NULL);
    perror("execl failed");
    return 1;
}
gcc -static -o init init.c
staticでbuild

そしてinitに改名

cd initrafs
find . | cpio -o -H newc | gzip > ../initramfs.cpio.gz

qemu-system-x86_64 -kernel arch/x86/boot/bzImage -initrd initramfs.cpio -append "root=/dev/ram0 console=ttyS0"
で起動ができたらOK

次にUSBにgrub-installのマニュアルに従っていれる

すると
sudo qemu-system-x86_64 -drive file=/dev/sda,format=raw -serial stdio
で起動できるようになる

